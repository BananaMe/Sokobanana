# Sokobanana

## 1. *Тема на проект*

Ова е проект по предметот Визуелно програмирање. Темата на проектот е мала игра загатка во која играчот игра човек (работник) во магацин кој треба да ги намести сите кутти со банани на обележани места (целите). Играта се состои од 5 нивоа.

## 2. *Правила на играта и начин на играње*

Играчот ги користи стрелките за да се движи низ мапата.

Доколку се заглави играчот или стигне до точка што го спречува да го реши нивото може да притисне на копчето на тастатурата R за да се ресетира нивото.

Играчот не може да се движи на поле што е обележано како ѕид или банана кутија.

Играчот се движи само по една коцка во 4 насоки (горе, доле, лево и десно).

Играчот може да се движи на поле обележано како под или цел.

Целта на играта е играчот да ги турне кутиите банани на обележаните места.

Играчот може само да турка, не може да влече. Исто така играчот може да турка една кутија по ред. 

Играчот не е ограничен временски, само просторно.

Изгледот на нивоата се зачувани во различни .txt датотеки.

## 3. *Изглед на играта*

Почетниот прозорец е составен од 4 делови. Првиот дел е насловот, наместен на горниот дел од прозорот со текстот „***Sokobananа***“, под него на десната страна е сместено `Play` копчето и под него две текст полиња со инструкции за движење низ играта. На десната страна има краток опис на  играта.

Кога започнува првото ниво, насловот, описот и `Play` копчето исчезнуваат, а остануваат само текстуалинте кутии за ресетирање на нивото и стрелките за движење. На другата страна од прозорецот се појавува првото ниво исцртано со под, кутии банани, обележани места за бананите, играчот и „ништо“ простор, додека инструкциите на играта се наместени на десната страна.

По завршувањето на првото ниво, на прозорецот се исцртува второто ниво, повторно се прикажани инструкциите за играње.

Кога ќе се завршат сите 5 нивоа се отвора нов прозорец со наслов „***The End!***“ и  копче `OK`, кое при притискање го затвора прозорецот и воедно играта е завршена.

## 4. *Податочни структури*

Има 3 класи во кои се чуваат променливи и методи за функционирање на играта и 2 Windows Form за да може да се визуелизира играта.

Класата `Program` содржи
* статични променливи воглавно се користат во класата Fom1 за почитливост како и објекти од класите `Player` и `Level`.

Класата Form1 содржи:
* Метод за исцртување на нивото и негово ажурирање `private void Draw()`; 
* Метод за притискање на копче на екранот за да се започне играта `priavte void button1_Click (object sender, EventArgs e)`;
* Метод за детектирање дали некое копче од тастатурата е притиснато при што започнува функцијата за движење од Player класата `void Form1_Keypress (object sender, KeyEventArgs e)`;
* Метод за ажурирање и прецртување на целото ниво `private void timer1_Tick (object sender, EventArgs e)`.

Класата Level содржи:
* 2 приватни статични променливи (една е дво-димензионална низа, другата е цел број) кои се користат во рамки на класата;
* Метод за преведување на .txt датотеката во матрица за да може да се исцрта `public void Load (int num)`;
* Метод кој проверува дали е завршено нивото т.е. кутиите банани се на место `public static bool complete()`.

Класата Player содржи:
* 4 цело бројни променливи (2 за х и у координати на играчот соодветно именувани, една за бројот на чекори направено и една за бројот на туркање кутии направено);
* Метода за движење на играчот низ мапата и туркање на кутиите банани `public int Input (Keys k)`.

Класата The_End_Form содржи:
* Метода за при кликање на копчето ОК на екранот прозорецот се исклучува `private void button1_Click (object sender, EventArgs e)`.

Методата `Load` во класата `Level` е функција во која се преведува нивото во матрица за да може да се исцрта на екранот. Таа прима цел број како бројот на нивото што ќе го преведува и има 2 главни компоненти, try-catch исклучок и самото преведување на датотеката.

```c#
string[] lines;

            //try-catch exception кога num е поголем од 5 (бројот на нивоа во играта)
            try
            {
                lines = File.ReadAllLines(@"..\..\Levels\" + num + "_lvl.txt", Encoding.UTF8);
            }
            catch
            {
                bananas = -1;
                return;
            }
```
**Try-catch** исклучокот се активира само кога во папката не може да го најде следното ниво (обично се активира кога е завршено последното ниво бидејќи се зголемува како што се завршува моменталното ниво).

```c#
bananas = 0;
            int height = lines.Length;
            int width = lines[0].Length;
            tiles = new string[height, width];  
            for (int y = 0; y < height; ++y)
            {
                var line = lines[y];
                int x = 0;

                /*w - ѕид
                 B -  банана
                 . - под
                 S - почетно место на играчот
                 G - обележано место за бананите*/
                foreach (char c in line)
                {
                    if (c == 'W') tiles[y, x++] = "wall";
                    else if (c == 'B')
                    {
                        tiles[y, x++] = "banana/floor";
                                                ++bananas;  
                    }
                    else if (c == '.') tiles[y, x++] = "floor";
                    else if (c == 'S')
                    {
                        tiles[y, x++] = "floor";
                        Program.player.X = x;
                        Program.player.Y = y;
                    }
                    else if (c == 'G') tiles[y, x++] = "goal";
                    else tiles[y, x++] = "none";
                }
            }
```
Самото преведување на датотеката поминува низ секоја редица во датотеката (всушност е висина) и ги заменува карактерите со зборови соодветно (`‘w’ - ѕид, ‘B’ -  банана, ‘.’ - под, ‘S’ - почетно место на играчот, ‘G’ - обележано место за бананите и ‘#’ - „ништо“ простор`). 

Доколку се најде карактерот B во датотеката се бележи како „banana/floor“ за да се означи дека е кутија со банани која не е на место (кое во `Player.Input` и во `Form1.Draw` се проверува дали е или не е за да се постави точната слика). Исто така за секоја внесена кутија со банана се зголемува бројачот на кутии со банани, `bananas`, која ќе се користи подоцна за дали е завршено нивото. За карактерот ‘S’ се поставува подот, но тие координати се поставуваат на играчот како почетни координати. Ако не одговара на ниту едно од карактерите (‘W’, ‘.’, ‘B’, ‘G’, ‘S’) се бележи како „none“ и се поставува „ништо“ просторот на негово место.

```c#
public static bool complete()
        {
            int completeBanana = 0;
            for (int y = 0; y < tiles.GetLength(0); ++y)
            {
                for (int x = 0; x < tiles.GetLength(1); ++x)
                {
                    if (tiles[y,x] == "banana/goal")
                    {
                        ++completeBanana;
                    }
                }
            }
            return completeBanana == bananas;
        }
```
Во методата `complete()` се проверува дали е завршено нивото т.е. дали се наместени кутиите со банани на обележаните места.
* Декларира цело бројна променлива `completeBanana = 0` со која, преку вгнезден for циклус се поминува секој стринг за дали совпаѓа на „banana/goal“, ако да, се зголемува бројачот `completeBanana` за едно.
* На крајот на циклусот се проверуваат дали `completeBanana == bananas` т.е. имаат еднакви вредности, ако да враќа true вредност.
* Оваа метода се повикува во `Form1.Form_KeyPress` за во случај ако е точна вредноста што ја враќа да се зголеми бројачот на нивото, `Program.currLevel` за едно.
